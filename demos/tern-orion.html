<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>Tern - Orion Editor</title>
	<style type="text/css" media="screen">	    
		#editor {
			//border: 1px solid teal;
			position: absolute;
			top: 0px;
			left: 0px;
			bottom: 0px;
			right: 0px;
			//margin: 20px;
			margin: 0px;
		}
		
		pre {
			margin: 0px;
		}
	</style>  	
	<!-- Tern JS -->
	<script src="scripts/ternjs/acorn/acorn.js"></script>
	<script src="scripts/ternjs/acorn/acorn_loose.js"></script>
	<script src="scripts/ternjs/acorn/util/walk.js"></script>
	<script src="scripts/ternjs/tern/lib/signal.js"></script>
	<script src="scripts/ternjs/tern/lib/tern.js"></script>
	<script src="scripts/ternjs/tern/lib/def.js"></script>
	<script src="scripts/ternjs/tern/lib/comment.js"></script>
	<script src="scripts/ternjs/tern/lib/infer.js"></script>
		
	<script src="browser.json.js"></script>
	<script src="ecma5.json.js"></script>

	<!-- Orion -->
	<link rel="stylesheet" type="text/css" href="scripts/orion/built-editor.css"/>
	<script src="scripts/orion/built-editor.js"></script>
	<!-- Orion & Tern -->
	<script src="../lib/tern-orion.js"></script>

</head>
<body>
	<pre id="editor" data-editor-show-annotation-ruler="true" >var elt = document.getElementById('xxx');</pre>
	<script>
	    require(["orion/editor/edit", "orion/tern/ternServer"], function(edit, mTernServer) {
			var editor = edit({
				lang: "js"
			});
			
			// tern server
			var defs = [ternBrowserDef, ternEcma5Def];
			var ternServer = new mTernServer.TernServer({defs: defs});
			
			// tern completion
			var contentAssist = editor.getContentAssist ? editor.getContentAssist() : editor._contentAssist;
			contentAssist.addEventListener("Activating", function() { //$NON-NLS-0$
				var ternProvider = ternServer.getContentAssistProvider(editor);
			  	if (contentAssist.providers) {
			  	  // Orion < 5.0
			  	  contentAssist.providers.push(ternProvider);
			  	} else {
			  	  // Orion >= 5.0
			  	  var providers = [];
			  	  var infos = contentAssist._providerInfoArray
			  	  if (infos) {
			  	    for(var i=0; i<infos.length; i++) {
			  	    	providers.push(infos[i].provider);
			  	    }			  	    
			  	  }
			  	  providers.push(ternProvider);
			  	  contentAssist.setProviders(providers);
			  	}
			});
		});	        
	</script>	
</body>
</html>
